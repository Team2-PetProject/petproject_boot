<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.member.dao.MemberBoardDAO">

	<select id="totalCountBoard" resultType="Integer">
		SELECT
			   COUNT(*)
		FROM
			   TB_BOARD
	</select>

	<select id = "totalSearchCount" resultType="Integer">
		SELECT
			   COUNT(*)
		FROM
			   TB_BOARD
		WHERE
			   TITLE = #{title}

	</select>

	<select id="boardList" parameterType="MemberBoardPageDTO" resultType="MemberBoardListDTO">
		SELECT
		*
		FROM
		(
		SELECT
			   ROWNUM AS IDX
			   ,BOARD.*
		FROM
		(
		SELECT
			   BOARD_CD
			   ,MB_ID
			   ,TITLE
			   ,CN
			   ,RPL_CNT
			   ,CRT_TM
			   ,UP_TM
		FROM
			   TB_BOARD
		ORDER BY CRT_TM DESC
		)
		"BOARD"
		)
		WHERE
			   IDX
		BETWEEN
			   #{startIdx}
		AND
			   #{endIdx}
	</select>

	<select id="boardSearch" parameterType="MemberBoardPageDTO" resultType="MemberBoardListDTO">
		SELECT
		*
		FROM
		(
		SELECT
			   ROWNUM AS IDX
			   ,BOARD.*
		FROM
		(
		SELECT
			   BOARD_CD
			   ,MB_ID
			   ,TITLE
			   ,CN
			   ,RPL_CNT
			   ,CRT_TM
			   ,UP_TM
		FROM
			   TB_BOARD
		WHERE
			   TITLE = #{title}
		ORDER BY CRT_TM DESC
		)
		"BOARD"
		)
		WHERE
			   IDX
		BETWEEN
			   #{startIdx}
		AND
			   #{endIdx}
	</select>

	<select id="countrplCnt" parameterType="Integer" resultType="Integer">
	SELECT
		MAX(RPL_CD)
	FROM
		TB_REPLY
	WHERE
		BOARD_CD = #{boardCd}
	</select>

	<select id="boardSelectOne" parameterType="Integer" resultType="MemberBoardDTO">
	SELECT
		BOARD_CD
		,MB_ID
		,TITLE
		,CN
		,RPL_CNT
		,CRT_TM
		,UP_TM
	FROM
		TB_BOARD
	WHERE
		BOARD_CD = #{boardCd}
	</select>


	<insert id="addBoard" parameterType="MemberBoardDTO">
		INSERT INTO
		TB_BOARD
		(
			   BOARD_CD
			   ,MB_ID
			   ,TITLE
			   ,CN
			   ,RPL_CNT
			   ,CRT_TM
			   ,UP_TM
		)
		VALUES
		(
			   TB_BOARD_SEQ.NEXTVAL
			   ,#{mbId}
			   ,#{title}
			   ,#{cn}
			   ,#{rplCnt}
			   ,SYSDATE
			   ,SYSDATE
		)
	</insert>

	<update id="updateBoard" parameterType="MemberBoardDTO">
		UPDATE
			   TB_BOARD
		SET
			   CN = #{cn}
			   ,UP_TM = SYSDATE
		WHERE
			   BOARD_CD = #{boardCd}

	</update>

	<update id="deleteBoard" parameterType="MemberBoardDTO">
		UPDATE
			   TB_BOARD
		SET
			   CN = NULL
		WHERE
			   BOARD_CD = #{boardCd}
	</update>

</mapper>